<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹€í¬ì‹œ ì•„íŒŒíŠ¸ ê´€ë¦¬ ì±Œë¦°ì§€ [Ranking Pro Plus]</title>
    <style>
        :root { 
            --gimpo-blue: #005bac; --gimpo-gold: #ffcc00; --danger: #e74c3c; --success: #2dce89; 
            --sky: #81d4fa; --canal: #4fc3f7; --night-blue: #001a33;
        }
        
        * { box-sizing: border-box; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: var(--sky); transition: 2s; }
        body.night-mode { background: var(--night-blue); }

        /* ğŸ™ï¸ ê¹€í¬ ë¼ë² ë‹ˆì²´ ê¸ˆë¹›ìˆ˜ë¡œ ë°°ê²½ */
        #laveniche-bg { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; overflow: hidden; pointer-events: none; }
        .canal { position: absolute; bottom: 0; width: 100%; height: 15vh; background: linear-gradient(to bottom, #29b6f6, #0288d1); opacity: 0.8; }
        .terrace-shops { position: absolute; bottom: 15vh; width: 100%; height: 12vh; display: flex; justify-content: space-around; align-items: flex-end; width: 120%; left: -10%; }
        .shop { width: 50px; height: 70px; background: #ffcc80; border: 2px solid #ef6c00; }
        .bridge { position: absolute; bottom: 14vh; width: 200px; height: 50px; background: #cfd8dc; border-radius: 100px 100px 0 0; left: 50%; transform: translateX(-50%); border: 4px solid #90a4ae; z-index: 2; }

        /* ğŸ“¦ ê²Œì„ ë©”ì¸ ë°•ìŠ¤ */
        #game-box { 
            background: rgba(255, 255, 255, 0.96); width: 95%; max-width: 600px; padding: 25px; 
            border-radius: 40px; box-shadow: 0 25px 50px rgba(0,0,0,0.3); border: 6px solid var(--gimpo-gold); 
            text-align: center; position: relative; backdrop-filter: blur(10px);
        }
        .hidden { display: none !important; }

        /* ğŸ  3D ì•„íŒŒíŠ¸ ì‹œê° íš¨ê³¼ */
        #apt-visual-container { width: 100%; height: 260px; display: flex; align-items: flex-end; justify-content: center; margin-bottom: 10px; perspective: 1500px; }
        #apt-building { width: 180px; height: 240px; position: relative; transform-style: preserve-3d; transform: rotateY(-25deg) rotateX(10deg); transition: 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); filter: drop-shadow(10px 20px 30px rgba(0,0,0,0.3)); }
        .face { position: absolute; box-sizing: border-box; border: 1px solid rgba(0,0,0,0.2); }
        .front { width: 180px; height: 240px; background: linear-gradient(135deg, #b0bec5 0%, #78909c 100%); display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); gap: 6px; padding: 12px; transform: translateZ(40px); }
        .side { width: 80px; height: 240px; background: linear-gradient(to right, #546e7a, #37474f); transform: rotateY(90deg) translateZ(140px); }
        .top { width: 180px; height: 80px; background: #cfd8dc; transform: rotateX(90deg) translateZ(40px); border: 4px solid #90a4ae; }

        .window { background: linear-gradient(135deg, #263238 0%, #102027 100%); border: 1.5px solid #455a64; border-radius: 2px; display: flex; justify-content: center; align-items: center; overflow: hidden; width: 100%; height: 100%; transition: 0.5s; position: relative; }
        .neon-on { background: radial-gradient(circle, #fff9c4 20%, #fff01f 100%) !important; box-shadow: 0 0 15px #fff01f; border-color: #fffde7; }
        .resident { font-size: 24px; animation: personPop 0.5s forwards; }
        @keyframes personPop { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1.1); opacity: 1; } }

        /* ğŸš¨ ì˜¤ë‹µ ì˜¤ë²„ë ˆì´ */
        .overlay { position: absolute; top: -5px; left: -5px; width: calc(100% + 10px); height: calc(100% + 10px); background: rgba(0, 0, 0, 0.98); z-index: 3000; border-radius: 35px; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #fff; padding: 25px; }
        #fine-text { color: #ff3e3e; font-size: 28px; font-weight: 900; animation: shake 0.1s infinite; margin-bottom: 15px; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -3px); } }

        .law-guide-box { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); padding: 15px; border-radius: 15px; width: 100%; text-align: left; margin-bottom: 15px; }
        .law-guide-box b { color: var(--gimpo-gold); display: block; margin-bottom: 5px; font-size: 16px; }

        .choice-btn { padding: 15px; border: 3px solid #eee; border-radius: 15px; background: #fff; cursor: pointer; font-size: 16px; font-weight: 800; transition: 0.2s; margin-bottom: 8px; width: 100%; color: #333; }
        .choice-btn:hover { border-color: var(--gimpo-blue); background: #f0f7ff; }
        .action-btn { padding: 18px; border: none; border-radius: 20px; font-weight: 900; color: #fff; font-size: 19px; width: 100%; cursor: pointer; box-shadow: 0 5px 0 rgba(0,0,0,0.1); margin-top: 10px; }
        
        #certificate { background: #fff; border: 10px double var(--gimpo-gold); padding: 25px; color: #222; margin-top: 20px; }
        .mascot { width: 80px; animation: bounce 0.6s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-12px); } }
    </style>
</head>
<body>

<audio id="audio-cheer" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
<audio id="audio-boo" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

<div id="laveniche-bg">
    <div class="bridge"></div>
    <div class="terrace-shops"><script>for(let i=0; i<10; i++) document.write('<div class="shop"></div>');</script></div>
    <div class="canal"></div>
</div>

<div id="game-box">
    <div id="view-1">
        <div style="background: var(--gimpo-gold); color: #333; font-weight: 900; padding: 6px 20px; border-radius: 50px; display: inline-block; margin-bottom: 10px; font-size: 12px;">ì „êµ­ìµœì´ˆ! ê³µë™ì£¼íƒ ê´€ë¦¬ ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜</div>
        <h1 style="color: var(--gimpo-blue); font-size: 22px; margin: 10px 0;">ê¹€í¬ì‹œ ì•„íŒŒíŠ¸! ê´€ë¦¬! ì±Œë¦°ì§€<br><span style="color:#ff5722">ë¼ë² ë‹ˆì²´ ê¸ˆë¹›ìˆ˜ë¡œ í”„ë¡œì íŠ¸ ğŸ </span></h1>
        <div style="margin: 15px 0;">
            <img src="posu.png" class="mascot" onerror="this.src='https://via.placeholder.com/80?text=POSU'">
            <img src="pomi.png" class="mascot" style="animation-delay: 0.3s;" onerror="this.src='https://via.placeholder.com/80?text=POMI'">
        </div>
        <p style="font-weight: 800; font-size: 17px; color: #444;">ê¸ˆë¹›ìˆ˜ë¡œ ìœ„ì—ì„œ í¼ì³ì§€ëŠ” ì‹¤ë¬´ ì±Œë¦°ì§€!<br>ì „êµ­ ìµœì´ˆì˜ ì•„íŒŒíŠ¸ ë°¸ëŸ°ìŠ¤ ê²Œì„ì— ì°¸ì—¬í•˜ì„¸ìš”!</p>
        <button class="action-btn" style="background: var(--gimpo-blue);" onclick="startFlow()">ë„ì „ ì‹œì‘í•˜ê¸°! â”</button>
    </div>

    <div id="view-2" class="hidden">
        <h2 style="color: var(--gimpo-blue); font-size: 20px;">ğŸ˜ï¸ ì°¸ì—¬ ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</h2>
        <select id="select-region" style="width: 100%; padding: 18px; border-radius: 12px; border: 2px solid #ddd; font-weight: 700; font-size: 18px; margin-bottom: 20px;">
            <option value="">-- ìš°ë¦¬ ë™ë„¤ ì„ íƒí•˜ê¸° --</option>
            <option value="ì‚¬ìš°ë™">1. ì‚¬ìš°ë™</option><option value="ì¥ê¸°ë™">2. ì¥ê¸°ë™</option>
            <option value="ë¶ë³€ë™">3. ë¶ë³€ë™</option><option value="ê°ì •ë™">4. ê°ì •ë™</option>
            <option value="êµ¬ë˜ë™">5. êµ¬ë˜ë™</option><option value="ë§ˆì‚°ë™">6. ë§ˆì‚°ë™</option>
            <option value="ìš´ì–‘ë™">7. ìš´ì–‘ë™</option><option value="í’ë¬´ë™">8. í’ë¬´ë™</option>
            <option value="ì–‘ì´Œì">9. ì–‘ì´Œì</option><option value="ê³ ì´Œì">10. ê³ ì´Œì</option>
            <option value="í†µì§„ì">11. í†µì§„ì</option>
        </select>
        <button class="action-btn" style="background: var(--success);" onclick="checkAndStart()">ì§„ì§œ ì‹œì‘! â”</button>
    </div>

    <div id="view-game" class="hidden">
        <div id="apt-visual-container">
            <div id="apt-building">
                <div class="face top"></div><div class="face side"></div>
                <div class="face front" id="apt-front">
                    <script>for(let i=0; i<20; i++) document.write('<div class="window" id="win-'+i+'"></div>');</script>
                </div>
            </div>
        </div>

        <div id="sudden-event-screen" class="hidden overlay" style="background: linear-gradient(135deg, #ff5722 0%, #3e2723 100%);">
            <h1 id="sudden-title" style="font-size: 28px;">âš ï¸ ëŒë°œ ìƒí™©!</h1>
            <p id="sudden-desc" style="padding: 0 30px; font-size: 17px;"></p>
            <button class="choice-btn" id="sudden-btn-1" onclick="handleSudden('a')"></button>
            <button class="choice-btn" id="sudden-btn-2" onclick="handleSudden('b')"></button>
        </div>

        <div id="area-question">
            <div style="font-weight: 900; color: var(--gimpo-blue); margin-bottom: 5px; font-size: 13px;">STAGE <span id="current-idx">1</span> / 20</div>
            <div id="txt-question" style="min-height: 70px; font-size: 18px; font-weight: 800; line-height: 1.4; margin-bottom: 15px;"></div>
            <div class="btn-list">
                <button class="choice-btn" id="btn-a" onclick="checkAnswer('a')"></button>
                <button class="choice-btn" id="btn-b" onclick="checkAnswer('b')"></button>
            </div>
        </div>

        <div id="area-feedback" class="hidden">
            <div id="wrong-screen" class="hidden overlay">
                <div id="fine-text">ğŸš¨ ê³¼íƒœë£Œ ë°œìƒ ì£¼ì˜ ğŸš¨</div>
                <div class="law-guide-box">
                    <b id="guide-correct-ans"></b>
                    <span id="guide-legal-ref" style="font-size: 14px; color: #ddd; line-height: 1.5;"></span>
                </div>
                <button class="action-btn" style="background: var(--danger); width: 80%;" onclick="directNext()">ë‚´ìš© ìˆ™ì§€ ì™„ë£Œ â”</button>
            </div>
            <div id="correct-feedback-box">
                <div id="card-feedback" style="padding: 15px; border-radius: 15px; background: #f8fbff; border: 2px solid #e1e4e8; margin-top: 10px; font-size: 14px; text-align: left; color: #333;"></div>
                <button class="action-btn" style="background: #333;" onclick="directNext()">ë‹¤ìŒ ë¬¸ì œë¡œ â”</button>
            </div>
        </div>
    </div>

     <div id="view-result" class="hidden">
        <h1 style="font-size: 22px; color: var(--gimpo-blue);">ì±Œë¦°ì§€ ì¢…ë£Œ!</h1>
        <p style="margin: 0; font-weight: 800; color: #666;">ê·€í•˜ì˜ ìµœì¢… ì‹¤ë¬´ ì ìˆ˜ëŠ”?</p>
        <div style="font-size: 65px; font-weight: 900; color: var(--gimpo-blue); margin: 5px 0;"><span id="txt-score">0</span></div>
        
        <div style="background: #fff; padding: 15px; border-radius: 20px; border: 3px solid #eee; text-align: left; margin-bottom: 15px;">
            <p style="font-weight: 900; color: var(--gimpo-blue); border-bottom: 2px solid var(--gimpo-gold); padding-bottom: 5px; font-size: 15px; margin-bottom: 10px;">ğŸ† ê¹€í¬ì‹œ ì‹¤ì‹œê°„ ì§€ì—­ ë­í‚¹</p>
            <div id="leaderboard" style="line-height: 2; font-size: 14px; color: #444;"></div>
        </div>

        <button class="action-btn" style="background: var(--gimpo-gold); color: #333;" onclick="goPage('cert')">ğŸ† ë§ˆìŠ¤í„° ì¸ì¦ì„œ í™•ì¸í•˜ê¸°</button>
        <button class="action-btn" style="background: #eee; color: #666; font-size: 14px; padding: 10px;" onclick="location.reload()">ë„ì „ ë‹¤ì‹œí•˜ê¸°</button>
    </div>

    <div id="view-cert" class="hidden">
        <div id="view-certificate-area">
            <p style="font-weight: 800; color: #af8f2c; font-size: 14px; margin: 0; text-decoration: underline;">CERTIFICATE OF MASTER</p>
            <h2 style="font-size: 28px; margin: 15px 0; color: #222;">íˆ¬ëª…ê´€ë¦¬ ë§ˆìŠ¤í„° ì¸ì¦ì„œ</h2>
            
            <div style="margin: 25px 0; text-align: left; padding: 0 10px;">
                <p style="font-size: 16px; line-height: 1.8; color: #444;">
                    ì„± ëª…: <b>ê¹€í¬ì‹œ ì•„íŒŒíŠ¸ ë¦¬ë”</b><br>
                    ì§€ ì—­: <b><span id="final-region"></span></b><br>
                    ì§€ ìˆ˜: <b><span id="final-score"></span>ì </b>
                </p>
                <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
                <p style="font-size: 14px; line-height: 1.6; color: #555; text-align: center;">
                    ê·€í•˜ëŠ” ê¹€í¬ì‹œ ì•„íŒŒíŠ¸ ê´€ë¦¬ ì±Œë¦°ì§€ 20ë¬¸í•­ì„ ì„±ì‹¤íˆ ì™„ìˆ˜í•˜ì˜€ìœ¼ë©°, 
                    íˆ¬ëª…í•˜ê³  ê³µì •í•œ ê³µë™ì²´ ë¬¸í™”ë¥¼ ì¡°ì„±í•˜ëŠ” ë° ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” 
                    ìš°ìˆ˜í•œ ì‹¤ë¬´ ì—­ëŸ‰ì„ ê°–ì¶”ì—ˆìŒì„ ì¸ì¦í•©ë‹ˆë‹¤.
                </p>
            </div>

            <div style="margin-top: 40px;">
                <p style="font-size: 18px; font-weight: 900; color: #333; letter-spacing: 4px;">ê¹€ í¬ ì‹œ</p>
                <p style="font-size: 11px; color: #999;"><span id="cert-date"></span> ë°œí–‰</p>
            </div>
        </div>
        <button class="action-btn" style="background: var(--gimpo-blue); margin-top: 20px;" onclick="location.reload()">ì²« í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<script>
    const DB_URL = "https://script.google.com/macros/s/AKfycbzfDaOp4rkneAMoaH_mRzwb6-5GSsHPVntUuF3brnjp-mruhO_KCsCRamo_PWejiFrc/exec";

    let audioCtx, intervalId;
    function initAudio() { if (audioCtx) return; audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
    function startBGM() {
        if (intervalId) return;
        const tempo = 124; const beatTime = 60/tempo;
        const bassNotes = [55, 55, 82, 73]; let step = 0;
        intervalId = setInterval(() => { playKick(); playBass(bassNotes[step % bassNotes.length]); if (step % 2 === 0) playClap(); step++; }, beatTime * 1000);
    }
    function playKick() { if(!audioCtx) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type="sine"; osc.frequency.setValueAtTime(120, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime+0.15); gain.gain.setValueAtTime(0.2, audioCtx.currentTime); osc.connect(gain).connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.15); }
    function playBass(freq) { if(!audioCtx) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type="sawtooth"; osc.frequency.value=freq; gain.gain.setValueAtTime(0.04, audioCtx.currentTime); osc.connect(gain).connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.2); }
    function playClap() { if(!audioCtx) return; const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate*0.05, audioCtx.sampleRate); const data = buffer.getChannelData(0); for(let i=0; i<data.length; i++) data[i] = (Math.random()*2-1)*Math.exp(-i / 200); const noise = audioCtx.createBufferSource(); noise.buffer = buffer; const gain = audioCtx.createGain(); gain.gain.value=0.08; noise.connect(gain).connect(audioCtx.destination); noise.start(); }

    function logData(qIdx, isCorrect) {
        if (!DB_URL || DB_URL.includes("ì—¬ê¸°ì—")) return;
        fetch(DB_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({
                region: region,
                score: score,
                qIdx: qIdx,
                isCorrect: isCorrect ? "ì •ë‹µ" : "ì˜¤ë‹µ"
            })
        }).catch(e => console.error("ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨:", e));
    }

    const allData = [
        { q: "ì…ëŒ€ìœ„ ê³µê³  ì‹œ, 'ê¸°íƒ€ ì•ˆê±´'ìœ¼ë¡œë§Œ ê³µê³ í•˜ê³  ë‹¹ì¼ ì„¸ë¶€ ë‚´ìš©ì„ ì˜ê²°í–ˆë‹¤ë©´?", correct: "ì•ˆê±´ëª… ë¯¸ê¸°ì¬ë¡œ ì˜ê²° ë¬´íš¨", wrong: "ì „ì›ì°¬ì„± ì˜ê²° í–ˆë‹¤ë©´ ê°€ëŠ¥", strict: "ì„¸ë¶€ ì•ˆê±´ëª…ì„ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ ì˜ê²° íš¨ë ¥ì´ ì—†ìŠµë‹ˆë‹¤!", ref: "ë²•ë ¹: ì•ˆê±´ì˜ êµ¬ì²´ì  ëª…ì‹œ ì˜ë¬´" },
        { q: "ì…ì°° ê³µê³ ì— 'í˜„ì¥ì„¤ëª…íšŒ ì°¸ê°€ìë§Œ íˆ¬ì°° ê°€ëŠ¥' ëª…ì‹œ í›„, ë¶ˆì°¸ ì—…ì²´ê°€ íˆ¬ì°°í–ˆë‹¤ë©´?", correct: "ë¬´íš¨ ì²˜ë¦¬", wrong: "ë‚™ì°° ì‹œ ìœ íš¨ ì¸ì •", strict: "í˜„ì¥ì„¤ëª…íšŒ ë¶ˆì°¸ ì‹œ íˆ¬ì°° ìê²©ì´ ì—†ìŠµë‹ˆë‹¤!", ref: "ì‚¬ì—…ì ì„ ì •ì§€ì¹¨ ë³„í‘œ 3" },
        { q: "ì œí•œê²½ìŸì…ì°° ì‹œ ì‹¤ë‚´ ì†Œë…ì—…ì²´ì™€ ìˆ˜ëª© ì†Œë… ì—…ì²´ë¥¼ í•¨ê»˜ ì„ ì •í•  ìˆ˜ ìˆë‚˜?", correct: "ê°ê° ì„ ì • í•´ì•¼", wrong: "í•¨ê»˜ ì„ ì • ê°€ëŠ¥", strict: "ê°ì—¼ë³‘ì˜ˆë°©ë²•ê³¼ ì‚°ë¦¼ë³´í˜¸ë²•ì— ë”°ë¥¸ ì‚¬ì—…ì¢…ë¥˜ê°€ ë‹¤ë¥´ë¯€ë¡œ ê°ê° ì„ ì •í•´ì•¼ í•©ë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ ë³„í‘œ 1" },
        { q: "ì œí•œê²½ìŸì…ì°°ì—ì„œ ìœ íš¨ íˆ¬ì°° ì—…ì²´ê°€ 2ê°œì¸ ê²½ìš° ì…ì°°ì˜ íš¨ë ¥ì€?", correct: "3ê°œ ì—…ì²´ ë¯¸ë§Œìœ¼ë¡œ ìœ ì°°", wrong: "2ê°œ ì—…ì²´ ì¶©ì¡±ìœ¼ë¡œ ì„±ë¦½", strict: "ì œí•œê²½ìŸì€ ìµœì†Œ 3ì¸ ì´ìƒì˜ ìœ íš¨í•œ ì…ì°°ì´ í•„ìˆ˜ì…ë‹ˆë‹¤!", ref: "ì‚¬ì—…ì ì„ ì •ì§€ì¹¨ ì œ5ì¡°" },
        { q: "ìˆ˜ì˜ê³„ì•½ ì „ ì˜ê²° ì‹œ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ë‚´ìš©ì€?", correct: "ê³„ì•½ìƒëŒ€ì ë° ì¤‘ìš”ì¡°ê±´", wrong: "ìˆ˜ì˜ê³„ì•½ ì²´ê²° ì—¬ë¶€", strict: "ì—…ì²´ì™€ ì£¼ìš” ì¡°ê±´ì„ íŠ¹ì •í•˜ì§€ ì•Šì€ ì˜ê²°ì€ ë¬´ìš©ì§€ë¬¼ì…ë‹ˆë‹¤!", ref: "ì‚¬ì—…ì ì„ ì •ì§€ì¹¨ ì œ4ì¡°" },
        { q: "ë‚™ì°° ê²°ê³¼ K-apt ê³µê°œ ê¸°í•œì€?", correct: "ë‚™ì°°ì ê²°ì •ì¼ì˜ ë‹¤ìŒ ë‚  18:00ê¹Œì§€", wrong: "ê³„ì•½ì„œ ê³µê°œ ì‹œ ìƒëµ ê°€ëŠ¥", strict: "íˆ¬ëª…í•œ í–‰ì •ì„ ìœ„í•´ ë‹¤ìŒ ë‚  18ì‹œê¹Œì§€ ê³µê°œí•´ì•¼ í•©ë‹ˆë‹¤!", ref: "ì‚¬ì—…ì ì„ ì •ì§€ì¹¨ ì œ11ì¡°" },
        { q: "ê³µì‚¬ ê³„ì•½ ì‹œ ì—…ì²´ë¡œë¶€í„° ë°›ì•„ì•¼ í•˜ëŠ” ê³„ì•½ë³´ì¦ê¸ˆ ë¹„ìœ¨ì€?", correct: "20% ì´ìƒ", wrong: "10% ì´ìƒ", strict: "ë¦¬ìŠ¤í¬ ë°©ì§€ë¥¼ ìœ„í•´ 20% ì´ìƒì˜ ë³´ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ ì œ31ì¡°" },
        { q: "ìƒì‹œ ê·¼ë¬´ ìš©ì—­ ê³„ì•½ ì‹œ 4ëŒ€ ë³´í—˜ ê°€ì…ì¦ëª…ì„œ ì§•êµ¬ ê¸°í•œì€?", correct: "ê³„ì•½ì²´ê²° í›„ 1ê°œì›” ì´ë‚´", wrong: "ê³„ì•½ì²´ê²° í›„ 10ì¼ ì´ë‚´", strict: "4ëŒ€ ë³´í—˜ ê°€ì…ì¦ëª…ì„œëŠ” ê³„ì•½ì²´ê²° í›„ 1ê°œì›” ì´ë‚´ì— ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.", ref: "ì„ ì •ì§€ì¹¨ ì œ29ì¡°" },
        { q: "ì¥ì¶©ê¸ˆì„ ê³„íš ì¡°ì • ì—†ì´ ë³´ìˆ˜ì— ì‚¬ìš©í–ˆë‹¤ë©´?", correct: "ê³„íš ì¡°ì • í›„ ì‚¬ìš© í•„ìˆ˜", wrong: "ê¸´ê¸‰í•œ ê²½ìš°ë¼ë©´ ê°€ëŠ¥", strict: "ê³„íš ì—†ëŠ” ì‚¬ìš©ì€ í˜•ì‚¬ ì²˜ë²Œ ì‚¬ì•ˆì…ë‹ˆë‹¤!", ref: "ê³µë™ì£¼íƒê´€ë¦¬ë²• ì œ29ì¡°" },
        { q: "ì „ìì…ì°° ë§ˆê° ì‹œê°„ì´ 17:00ì…ë‹ˆë‹¤. 17:00:59 ë“±ë¡ë¶„ì€?", correct: "ë¬´íš¨", wrong: "ì •ìƒ ì ‘ìˆ˜", strict: "ì„œë²„ ì‹œê°„ 17ì‹œ ì •ê°ì´ ì§€ë‚˜ë©´ ë¬´íš¨ì…ë‹ˆë‹¤!", ref: "í‘œì¤€ ì„œë²„ ì‹œê°„ ê¸°ì¤€" },
        { q: "ì¡ìˆ˜ì…ì˜ ì·¨ë“ ì‚¬ì—…ì ì„ ì • ì‹œ ë‚™ì°° ë°©ë²•ì€?", correct: "ìµœê³ ê°€ íˆ¬ì°°ì ì„ ì •", wrong: "ìµœì €ê°€ ë‚™ì°°", strict: "ìˆ˜ìµ ì‚¬ì—…ì€ ìµœê³ ê°€ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ ë³„í‘œ 7" },
        { q: "ìµœì €ë‚™ì°°ì œ ê³µê³  ì‹œ ê¸°ì—…ì‹ ìš©í‰ê°€ë“±ê¸‰ í™•ì¸ì„œ ì œì¶œì„ ìš”êµ¬í•  ìˆ˜ ìˆë‚˜?", correct: "ì—†ë‹¤", wrong: "ìˆë‹¤", strict: "ì ê²©ì‹¬ì‚¬ì œ ì„œë¥˜ì´ë¯€ë¡œ ìµœì €ê°€ ì…ì°° ì‹œ ë³„ë„ë¡œ ìš”ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ ì œ27ì¡°" },
        { q: "ì¥ê¸°ìˆ˜ì„ ê³„íš ì •ê¸° ê²€í†  ì£¼ê¸°ëŠ”?", correct: "3ë…„", wrong: "5ë…„", strict: "3ë…„ë§ˆë‹¤ ì •ê¸° ê²€í† ê°€ ì˜ë¬´ì…ë‹ˆë‹¤!", ref: "ë²• ì œ29ì¡°" },
        { q: "ì ê²©ì‹¬ì‚¬ í‰ê°€ ì‹œ ìœ„ì› ëª‡ ëª… ì´ìƒ ì°¸ì—¬í•´ì•¼ í•˜ë‚˜ìš”?", correct: "5ì¸ ì´ìƒ", wrong: "3ì¸ ì´ìƒ", strict: "ì‹¬ì‚¬ì˜ ì •ë‹¹ì„±ì€ 5ì¸ë¶€í„° ì‹œì‘ë©ë‹ˆë‹¤!", ref: "ì‚¬ì—…ì ì„ ì •ì§€ì¹¨ ì œ13ì¡°" },
        { q: "ì£¼íƒê´€ë¦¬ì—…ì ì¬ê³„ì•½ ì‹œ ì…ì£¼ì ë™ì˜ ìš”ê±´ì€?", correct: "ì „ì²´ ì…ì£¼ìë“±ì˜ ê³¼ë°˜ìˆ˜ ì°¬ì„±", wrong: "1/10 ë™ì˜", strict: "ì „ì²´ ì…ì£¼ìë“±ì˜ ê³¼ë°˜ìˆ˜ ë™ì˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ ì œ4ì¡°" },
        { q: "ê³„ì•½ ì²´ê²° í›„ í™ˆí˜ì´ì§€/ê²Œì‹œíŒ ê³µê°œ ê¸°í•œì€?", correct: "1ê°œì›” ì´ë‚´", wrong: "3ê°œì›” ë‚´", strict: "1ê°œì›” ì´ë‚´ í™ˆí˜ì´ì§€ ë° ê²Œì‹œíŒ ê³µê°œê°€ ì›ì¹™ì…ë‹ˆë‹¤!", ref: "ê³µë™ì£¼íƒê´€ë¦¬ë²• ì œ28ì¡°" },
        { q: "ì „ê¸°ì•ˆì „ê´€ë¦¬ ê³µì‚¬ì˜ ê³„ì•½ì£¼ì²´ëŠ”?", correct: "ì…ì£¼ìëŒ€í‘œíšŒì˜", wrong: "ê´€ë¦¬ì£¼ì²´", strict: "ì „ê¸°ì•ˆì „ê´€ë¦¬ ê³„ì•½ì˜ ë‹¹ì‚¬ìëŠ” ì…ì£¼ìëŒ€í‘œíšŒì˜ ì…ë‹ˆë‹¤!", ref: "ì„ ì •ì§€ì¹¨ [ë³„í‘œ7]" },
        { q: "ê³„ì•½ì„œ ê³µê°œ ì¥ì†ŒëŠ”? (500ì„¸ëŒ€ ë¯¸ë§Œ)", correct: "í™ˆí˜ì´ì§€, K-APT, ë™ë³„ê²Œì‹œíŒ", wrong: "í™ˆí˜ì´ì§€, K-APT", strict: "ê³„ì•½ì„œ ê³µê°œëŠ” ì˜ë¬´ì´ë©° ê²Œì‹œíŒì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤!", ref: "ë²• ì œ26ì¡°" }
    ];

    const suddenEvents = [
        { title: "âš ï¸ ëŒë°œ ìƒí™© #1", desc: "\"ì „ê¸°ì°¨ í™”ì¬ê°€ ë°œìƒí–ˆì–´ìš”!\" ì§€í•˜ì£¼ì°¨ì¥ í™”ì¬ ë°œìƒ ì‹œ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  í–‰ë™ì€?", correct: "119ì— í™”ì¬ì‹ ê³  ì ‘ìˆ˜í•œë‹¤.", wrong: "ì¦‰ì‹œ ì†Œí™”ê¸°ë¡œ ì§„ì••í•œë‹¤." },
        { title: "âš ï¸ ëŒë°œ ìƒí™© #2", desc: "\"ìœ—ì§‘ ì†ŒìŒ ë•Œë¬¸ì— ë„ˆë¬´ í˜ë“¤ì–´ìš”!\" ì¸µê°„ì†ŒìŒ í•­ì˜ ì‹œ ê´€ë¦¬ì£¼ì²´ì˜ ì˜¬ë°”ë¥¸ í–‰ë™ì€?", correct: "í”¼í•´ ë‚´ìš©ì„ ì¶©ë¶„íˆ ë“£ê³  í™•ì¸ í›„ ì¤‘ì¬í•œë‹¤.", wrong: "ì§ì ‘ ìœ—ì¸µì— ì°¾ì•„ê°€ í•­ì˜í•˜ë„ë¡ í•œë‹¤." }
    ];

    let currentIndex = 0; let score = 0; let region = ""; let currentAnsPos = 'a';
    const humanFaces = ["ğŸ‘¨", "ğŸ‘©", "ğŸ‘´", "ğŸ‘µ", "ğŸ§‘", "ğŸ§’", "ğŸ§”", "ğŸ‘±", "ğŸ‘©â€ğŸ¦°", "ğŸ‘¨â€ğŸ¦±", "ğŸ‘©â€ğŸ’¼", "ğŸ‘¨â€ğŸ’¼", "ğŸ§‘â€ğŸ”¬", "ğŸ‘©â€ğŸ¨", "ğŸ‘¨â€ğŸ³", "ğŸ‘©â€ğŸ«", "ğŸ‘¨â€ğŸ’»", "ğŸ‘©â€âš•ï¸", "ğŸ‘®", "ğŸ‘©â€ğŸš’"];

    function goPage(num) {
        document.querySelectorAll('#game-box > div').forEach(div => div.classList.add('hidden'));
        const target = document.getElementById('view-' + num);
        if (target) target.classList.remove('hidden');
    }

    function startFlow() { initAudio(); goPage(2); }

    function checkAndStart() {
        region = document.getElementById('select-region').value;
        if (!region) { alert("ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”!"); return; }
        startBGM(); goPage('game'); updateUI();
    }

    function updateUI() {
        if(currentIndex === 6) { showSudden(0); return; }
        if(currentIndex === 13) { showSudden(1); return; }
        
        const qIdx = (currentIndex >= 14) ? currentIndex - 2 : (currentIndex >= 7) ? currentIndex - 1 : currentIndex;
        const q = allData[qIdx % allData.length];
        document.getElementById('current-idx').innerText = currentIndex + 1;
        document.getElementById('txt-question').innerText = q.q;
        
        if(Math.random() > 0.5) {
            document.getElementById('btn-a').innerText = q.correct;
            document.getElementById('btn-b').innerText = q.wrong;
            currentAnsPos = 'a';
        } else {
            document.getElementById('btn-a').innerText = q.wrong;
            document.getElementById('btn-b').innerText = q.correct;
            currentAnsPos = 'b';
        }
        document.getElementById('area-question').classList.remove('hidden');
        document.getElementById('area-feedback').classList.add('hidden');
        document.getElementById('wrong-screen').classList.add('hidden');
        if(currentIndex >= 10) document.body.classList.add('night-mode');
    }

    function checkAnswer(choice) {
        const qIdx = (currentIndex >= 14) ? currentIndex - 2 : (currentIndex >= 7) ? currentIndex - 1 : currentIndex;
        const q = allData[qIdx % allData.length];
        const isCorrect = (choice === currentAnsPos);
        
        logData(currentIndex + 1, isCorrect);

        document.getElementById('area-question').classList.add('hidden');
        document.getElementById('area-feedback').classList.remove('hidden');

        if (isCorrect) {
            score += 5;
            document.getElementById('audio-cheer').play();
            const win = document.getElementById('win-' + currentIndex);
            win.classList.add('neon-on');
            win.innerHTML = `<span class="resident">${humanFaces[currentIndex % 20]}</span>`;
            document.getElementById('correct-feedback-box').classList.remove('hidden');
            document.getElementById('card-feedback').innerHTML = `<b style="color:var(--success); font-size:16px;">âœ… ì •ë‹µ! ì™„ë²½í•œ ì‹¤ë¬´ ê°ê°ì…ë‹ˆë‹¤.</b><br><br>${q.ref}`;
        } else {
            document.getElementById('audio-boo').play();
            document.getElementById('correct-feedback-box').classList.add('hidden');
            document.getElementById('wrong-screen').classList.remove('hidden');
            document.getElementById('guide-correct-ans').innerText = "âœ… ì˜¬ë°”ë¥¸ ì •ë‹µ: " + q.correct;
            document.getElementById('guide-legal-ref').innerText = "âš–ï¸ ê´€ë ¨ ë²•ë ¹: " + q.ref;
        }
    }

    function showSudden(idx) {
        const s = suddenEvents[idx];
        document.getElementById('sudden-title').innerText = s.title;
        document.getElementById('sudden-desc').innerText = s.desc;
        if(Math.random() > 0.5) {
            document.getElementById('sudden-btn-1').innerText = s.correct;
            document.getElementById('sudden-btn-2').innerText = s.wrong;
            currentAnsPos = 'a';
        } else {
            document.getElementById('sudden-btn-1').innerText = s.wrong;
            document.getElementById('sudden-btn-2').innerText = s.correct;
            currentAnsPos = 'b';
        }
        document.getElementById('sudden-event-screen').classList.remove('hidden');
    }

    function handleSudden(btnId) {
        const isCorrect = (btnId === currentAnsPos);
        document.getElementById('sudden-event-screen').classList.add('hidden');
        if(isCorrect) { score += 5; document.getElementById('audio-cheer').play(); alert("í˜„ëª…í•œ íŒë‹¨ì…ë‹ˆë‹¤! (+5ì )"); }
        else { document.getElementById('audio-boo').play(); alert("ëŒ€ì‘ ë¯¸ìˆ™ìœ¼ë¡œ í‰íŒì´ í•˜ë½í–ˆìŠµë‹ˆë‹¤."); }
        currentIndex++; updateUI();
    }

    function directNext() {
        if (currentIndex < 19) { currentIndex++; updateUI(); }
        else { showResult(); }
    }

    function showResult() {
        if(intervalId) clearInterval(intervalId);
        goPage('result');
        document.getElementById('txt-score').innerText = score + "ì ";

        const baseRanks = [
            { name: "ì‚¬ìš°ë™", pts: 95 }, { name: "ì¥ê¸°ë™", pts: 90 }, { name: "êµ¬ë˜ë™", pts: 85 },
            { name: "ìš´ì–‘ë™", pts: 80 }, { name: "í’ë¬´ë™", pts: 75 }, { name: "ë¶ë³€ë™", pts: 70 },
            { name: "ë§ˆì‚°ë™", pts: 65 }, { name: "ê°ì •ë™", pts: 60 }, { name: "ì–‘ì´Œì", pts: 55 },
            { name: "ê³ ì´Œì", pts: 50 }, { name: "í†µì§„ì", pts: 45 }
        ];

        let found = false;
        baseRanks.forEach(r => { if(r.name === region) { r.pts = score; found = true; } });
        if(!found) baseRanks.push({ name: region, pts: score });
        baseRanks.sort((a, b) => b.pts - a.pts);

        let rankHTML = "";
        baseRanks.forEach((r, i) => {
            const isMy = (r.name === region);
            const style = isMy ? "color: var(--gimpo-blue); font-weight: 900; background: #fffde7; padding: 2px 8px; border-radius: 8px; display: inline-block; width: 100%;" : "";
            rankHTML += `<div style="margin-bottom: 5px; ${style}">${i+1}ìœ„. ${r.name}: ${r.pts}ì ${isMy ? ' (MY)' : ''}</div>`;
        });
        document.getElementById('leaderboard').innerHTML = rankHTML;

        // [ìˆ˜ì • ì‚¬í•­] ì¸ì¦ì„œ ë°ì´í„° ë° ì˜¤ëŠ˜ ë‚ ì§œ ì„¸íŒ…
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const date = today.getDate();
        
        document.getElementById('final-region').innerText = region;
        document.getElementById('final-score').innerText = score;
        document.getElementById('cert-date').innerText = `${year}ë…„ ${month}ì›” ${date}ì¼`;

        saveToGoogle();
    }

    function saveToGoogle() {
        const scriptUrl = "ë°œê¸‰ë°›ì€_êµ¬ê¸€_ì›¹ì•±_URL"; 
        if(scriptUrl === "ë°œê¸‰ë°›ì€_êµ¬ê¸€_ì›¹ì•±_URL") return;

        fetch(scriptUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                region: region,
                score: score
            })
        });
    }
</script>
</body>
</html>
